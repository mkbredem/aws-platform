---
- hosts: localhost
  connection: local
  gather_facts: no
  vars:
    login: &login
      server_url: "{{ lookup('env', 'SATELLITE_SERVER_URL') }}"
      username: "{{ lookup('env', 'SATELLITE_USERNAME') }}"
      password: "{{ lookup('env', 'SATELLITE_PASSWORD') }}"
      validate_certs: "{{ lookup('env', 'SATELLITE_VALIDATE_CERTS') }}"
    organization: Default Organization
#    lifecycle_environment: "{{ content_view }}_{{ env }}"
#    content_view: undef
    publish_timeout: 14400
    publish_retry_interval: 15

  tasks:

  - name: Show creds
    debug:
      msg:
        - "server_url: {{ lookup('env', 'SATELLITE_SERVER_URL') }}"
        - "username: {{ lookup('env', 'SATELLITE_USERNAME') }}"
        - "password: {{ lookup('env', 'SATELLITE_PASSWORD') }}"
        - "validate_certs: {{ lookup('env', 'SATELLITE_VALIDATE_CERTS') }}"

  - name: "Create or update content view"
    redhat.satellite.content_view:
      server_url: "{{ lookup('env', 'SATELLITE_SERVER_URL') }}"
      username: "{{ lookup('env', 'SATELLITE_USERNAME') }}"
      password: "{{ lookup('env', 'SATELLITE_PASSWORD') }}"
      validate_certs: false
      name: "Test RHEL7"
      organization: "{{ organization }}"
      repositories:
        - name: 'Red Hat Enterprise Linux 7 Server - Extras RPMs x86_64'
          product: 'Red Hat Enterprise Linux Server'

  - name: Publish Content View
    redhat.satellite.content_view_version:
      server_url: "{{ lookup('env', 'SATELLITE_SERVER_URL') }}"
      username: "{{ lookup('env', 'SATELLITE_USERNAME') }}"
      password: "{{ lookup('env', 'SATELLITE_PASSWORD') }}"
      validate_certs: false
      content_view: "Test RHEL7"
      organization: "{{ organization }}"
      lifecycle_environments: 
        - "Library"
    register: publish_async

...